<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Ganesan Karuppaiya : Resume PDF to Download</title>
    <style>
      body,
      html {
        padding: 0;
        margin: 0;
      }

      #pdfV {
        left: 0;
        right: 0;
        bottom: 0;
        top: 0%;
        height: 100vh;
        width: 100%;
        position: absolute;
        border: 0;
      }
    </style>
  </head>

  <body translate="no">
    <script src="https://unpkg.com/mithril"></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.20/pdfmake.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.20/vfs_fonts.js"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"
      integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ=="
      crossorigin="anonymous"
    ></script>
    <script id="rendered-js">
      function dates(s, e) {
        return `${s ? moment(s, "YYYY-MM-DD").format("MMM YYYY") : ""} ${s ? ' - ' : ""}${e ? moment(e, "YYYY-MM-DD").format("MMM YYYY") : "Present"}`;
      }

      function sectionTitle(name) {
        return [
          "\n",
          {
            table: {
              widths: ["*"],
              body: [
                [
                  {
                    text: name.toUpperCase(),
                    style: "sectionHeader",

                    tocItem: true,
                  },
                ],
              ],
            },
          },
          "\n",
        ];
      }
      function BlueTitle1(name) {
        return { text: name, style: "title" };
      }

      function expertiseList(list) {
        const pp = {
          color: "#4954b8",
          markerColor: "red",
          ul: [],
        };
        list.forEach(function (item, index) {
          const lists = [];
          item.content.forEach(function (lister, index) {
            lists.push(lister.title);
          });
          const p = [
            { text: item.title, bold: true },
            { text: lists.join(", "), italics: true, color: "#000000" },
          ];
          pp.ul.push(p);
        });
        return pp;
      }

      function experienceList(item) {
        const content = [];
        const titleTable = {
          table: {
            headerRows: 1,
            widths: ["*", "auto"],
            body: [
              [{ text: item.title }, { text: item.location }],
              [
                { text: item.company, link: item.link },
                {
                  text:
                  dates(item.startdate,  item.enddate),
                },
              ],
            ],
          },
        };
        const resp = {
          markerColor: "red",
          ul: [],
        };
        if (item.content.length > 0) {
          item.content.forEach(function (it) {
            if (it.title) {
              resp.ul.push({ text: it.title });
            }
          });
        }
        content.push(titleTable);
        content.push("\n");

        content.push(item.desc);
        content.push("\n");

        content.push(resp);
        content.push("\n");
        return content;
      }

      function educationList(item) {
        const content = [];
        const titleTable = {
          table: {
            headerRows: 1,
            widths: ["*", "auto"],
            body: [
              [{ text: item.title }, { text: item.location }],
              [
                { text: item.institute },
                {
                  text:
                  dates(item.startdate,  item.enddate),
                },
              ],
            ],
          },
        };
        content.push(titleTable);
        content.push("\n");

        return content;
      }
      function projectsList(item) {
        const content = [];
        const titleTable = {
          table: {
            headerRows: 1,
            widths: ["*", "auto"],
            body: [
              [
                [{ text: item.title }, { text: item.company }],
                [
                  { text: item.size },
                  {
                  text:
                  dates(item.startdate,  item.enddate),
                },
                ],
              ],
            ],
          },
        };
        content.push(titleTable);
        content.push("\n");

        content.push(item.desc);
        content.push("\n");
        const technology = [
          { text: "Technology Used", bold: true },
          { text: item.content.join(", "), italics: true, color: "#000000" },
        ];

        content.push(technology);
        content.push("\n");
        return content;
      }

      function awardsList(item) {
        const content = [];
        const titleTable = {
          table: {
            headerRows: 1,
            widths: ["*", "auto"],
            body: [
              [
                { text: item.title },
                {
                  text:
                  dates(item.startdate,  item.enddate),
                },
              ],
              [{ text: item.institute }, { text: "" }],
              [{ text: item.desc }, { text: "" }],
            ],
          },
        };
        content.push(titleTable);
        content.push("\n");

        return content;
      }

      var Data = {
        todos: {
          list: null,
          error: "",
          fetch: function () {
            m.request({
              method: "GET",
              url:
                "https://ganesan-cv-cp.netlify.app/.netlify/functions/cv-read-all",
            })
              .then(function (items) {
                var regex = /(<([^>]+)>)/gi;
                const contentdata = [];
                items.forEach(function (item, index) {
                  contentdata.push(item.data);
                });

                ////title////
                const title = [
                  { text: contentdata[0].title, style: "header" },
                  { text: contentdata[0].subtitle, style: "subtitle" },
                ];

                ////contacts////
                const contacts = [];
                contentdata[1].content.forEach(function (item, index) {
                  contacts.push({ text: item.subtitle, link: item.link });
                });
                ///summary///
                const summary = {
                  text: contentdata[0].desc.replace(regex, ""),
                  style: "subheader",
                };

                /// Expertise///
                const expertise = [sectionTitle(contentdata[2].title)];
                contentdata[2].content.forEach(function (item, index) {
                  expertise.push(BlueTitle1(item.title));
                  expertise.push(expertiseList(item.content));
                });

                /// Experience///
                const experience = [sectionTitle(contentdata[4].title)];
                contentdata[4].content.forEach(function (item, index) {
                  experience.push(experienceList(item));
                });

                /// education///
                const education = [sectionTitle(contentdata[5].title)];
                contentdata[5].content.forEach(function (item, index) {
                  education.push(educationList(item));
                });

                /// projects///
                const projects = [sectionTitle(contentdata[6].title)];
                contentdata[6].content.forEach(function (item, index) {
                  projects.push(projectsList(item));
                });

                /// awards///
                const awards = [sectionTitle(contentdata[8].title)];
                contentdata[8].content.forEach(function (item, index) {
                  awards.push(awardsList(item));
                });

                Data.todos.list = contentdata;
                var documentDefinition = {
                  info: {
                    title: "Ganesan Karuppaiya Resume",
                    author: "Ganesan Karuppaiya",
                    subject: "",
                    keywords: contentdata[0].subtitle,
                  },
                  content: [
                    {
                      style: "tableExample",
                      table: {
                        widths: ["*", "auto"],
                        body: [[title, contacts]],
                      },
                    },
                    summary,
                    expertise,
                    experience,
                    education,
                    projects,
                    awards,
                    {
                      text: "pdfmake",
                      style: "header",
                    },
                  ],

                  styles: {
                    header: {
                      fontSize: 18,
                      bold: true,
                      margin: [0, 0, 0, 0],
                      alignment: "left",
                    },
                    tableHeader: {
                      fillColor: "#4CAF50",
                      color: "white",
                    },
                    sectionHeader: {
                      border: [true, false, false, false],
                      fillColor: "#efefef",
                    },
                  },
                };
                if (Data.todos.list) {
                  pdfMake
                    .createPdf(documentDefinition)
                    .getDataUrl(function (outDoc) {
                      document.getElementById("pdfV").src = outDoc;
                    });
                }
              })
              .catch(function (e) {
                Data.todos.error = e.message;
              });
          },
        },
      };

      var Todos = {
        oninit: Data.todos.fetch,
        oncreate: function (vnode) {
          console.log("Initialized with height of: ", vnode.dom.offsetHeight);
        },
        view: function (vnode) {
          return m(
            "div",
            m("iframe", { id: "pdfV" }),

            Data.todos.error
              ? [m(".error", Data.todos.error)]
              : Data.todos.list
              ? [
                  Data.todos.list.map(function (item) {
                    return m("div", item.title);
                  }),
                ]
              : m(".loading-icon")
          );
        },
      };

      m.route(document.body, "/", {
        "/": Todos,
      });
    </script>
  </body>
</html>
